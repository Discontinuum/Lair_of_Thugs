#textdomain wesnoth-vs

[scenario]
    id=vs_scenario_1
    name= _ "Injection"
    map_data="{~add-ons/Lair_of_Thugs/maps/01_Injection.map}"
    {TURNS 45 40 35}
    next_scenario=vs_scenario_2
    victory_when_enemies_defeated=yes
    carryover_percentage=40
    carryover_add=yes

    {TWO_SUNS_DEFAULT_SCHEDULE}

    current_time=5

    {SCENARIO_MUSIC revelation.ogg}

    [story]
        [part]
            title=<span size='35000' font_family='Oldania ADF Std'> + _"Disclaimer" + </span>
            music="data/core/sounds/ambient/wardrums.ogg"
            story= _ "This campaign changes certain Wesnoth standards, such as the nagas’ stats and the day/night cycle."
        [/part]
        [part]
            title=<span size='35000' font_family='Oldania ADF Std'> + _"Lair of Thugs" + </span>
            music=elf-land.ogg
            story= _ "The sandy hell that Irdya became after the great Fall forced the surviving races to find new ways to live. Some of them, like the elves, adapted to life in the desert. Thus came Quenoth and the Cult of Eloh, the last island of civilization in the sea of sand."
        [/part]
        [part]
            story= _ "Others found salvation in serving the dark forces that filled the wastelands. This is how cruel cults emerged, the worst of which was the cult of Uria, the mother of all Evil."
        [/part]
        [part]
            story= _ "And creatures equally indifferent to good and evil, but too weak to stand up for themselves, allied themselves with the mighty of this world, be they followers of Eloh or of Uria."
        [/part]
        [part]
            story= _ "This story is about such creatures, a small naga colony that shared an oasis with the elves of Quenoth. The burning suns had scorched the memories of the former enmity between the two races, and the nagas and elves lived harmoniously and shared together the hardships of life in the harsh sands."
        [/part]
        [part]
            story= _ "The elves protected the nearby dunes, and the nagas patrolled the river that flowed into the oasis. The river was the only source of water for miles around, and it was common for desert roamers to encroach on it."
        [/part]
        [part]
            title=<span size='35000' font_family='Oldania ADF Std'> + _"Scenario 1: Injection" + </span>
            story= _ "So young nagas Typhon and Python, who lead the colony, were not at all surprised when they discovered a camp of strangers on one of their forays."
        [/part]
    [/story]

    [side]
        side=1
        recruit="Thug,Footpad,Thief,Ruffian"
        {GOLD 160 120 80}
        fog=no
        shroud=no
        {SIDE_1_ESSENTIALS}
    [/side]

    [side]
        side=2
        recruit="Thug,Footpad,Thief,Ruffian"
        {SIDE_2_ESSENTIALS}
        {GOLD 160 120 80}
        fog=no
        shroud=no
    [/side]

    [side]
        side=3
        controller=ai
        disallow_observers=yes
        allow_player=no
        recruit=Small Mudcrawler
        type=Mudavenger
        id=DarkLeader
        name=_ "Arzoteq the Flesh Weaver"
        {GOLD 120 170 220}
        {INCOME 5 10 15}
        facing=nw
        team_name=undead
        user_team_name= _ "Cultists"
        color=green
        {FLAG_VARIANT undead}

        [ai]
            village_value={ON_DIFFICULTY 0.1 0.2 0.3}
        [/ai]

        {AI_IN_TIME {TWO_SUNS_CHAOTIC_TIME} (
        
            grouping=no
            aggression=1
            caution=0)}

        {AI_IN_TIME {TWO_SUNS_NEUTRAL_TIME} (
        
            grouping=defensive
            aggression=0.1
            caution=0.9
            retreat_factor=1
            reterat_enemy_weight=2)}

        {AI_IN_TIME {TWO_SUNS_LAWFUL_TIME} (
        
            grouping=offensive
            aggression=0.2
            caution=0.8)}
    [/side]

    [side]
        side=4
        controller=ai
        disallow_observers=yes
        allow_player=no
        type=Orcish Ruler
        id=OrcLeader
        facing=ne
        name=_ "Gyrza the Dead Eye"
        {GOLD 100 150 200}
        {INCOME 5 10 15}
        recruit=Orcish Archer,Orcish Grunt,Orcish Assassin
        team_name=orcs
        user_team_name= _ "Orcs"
        color=purple
        {FLAG_VARIANT ragged}

        [ai]
            village_value={ON_DIFFICULTY 0.1 0.2 0.3}
            recrument_pattern=Orcish Grunt,Orcish Grunt,Orcish Grunt,Orcish Assassin,Orcish Archer
        [/ai]

        {AI_IN_TIME {TWO_SUNS_CHAOTIC_TIME} (
        
            grouping=no
            aggression=1
            caution=0)}

        {AI_IN_TIME {TWO_SUNS_NEUTRAL_TIME} (
        
            grouping=defensive
            aggression=0.1
            caution=0.9
            retreat_factor=1
            reterat_enemy_weight=2)}

        {AI_IN_TIME {TWO_SUNS_LAWFUL_TIME} (
        
            grouping=offensive
            aggression=0.2
            caution=0.8)}
    [/side]

    [side]
        side=5
        controller=ai
        disallow_observers=yes
        allow_player=no
        no_leader=yes
        team_name=rebel_orcs
        user_team_name= _ "Rebel Orcs"
        hidden=yes
        color=brown
        {FLAG_VARIANT ragged}

        [ai]
            aggression=1
            [goal]
                name=target_unit
                [criteria]  
                    side=4
                [/criteria]
                value=100
            [/goal]
        [/ai]
    [/side]

    {LIMIT_CONTEMPORANEOUS_RECRUITS 4 "Orcish Assassin" {ON_DIFFICULTY 1 2 3}}

    {STARTING_VILLAGES_AREA 4 7 13 4}
    {HERODEATH_PART_1}

    [event]
    name=prestart 

        [label]
            x,y=22,15
            text=_ "Phantom Outpost"
        [/label]

        {GENERIC_UNIT 4 "Orcish Warrior" 8 12}
        {GENERIC_UNIT 4 "Orcish Warrior" 7 14}

        {TERR_MASK_IN_EVENT "{~add-ons/Lair_of_Thugs/maps/Phantom_Outpost_Mask.mask}" 18 12}

        {CHECK_LIGHT ({INDOORS})}

        [object]
            silent=yes
            id=Vussel_Orc
            name=_"The Vicious Vessel"
            image=items/ornate2.png
            description= _ "The mysterious vessel that Uria's cultists need so badly. It evokes an ominous energy, but at the same time, it beckons you to hold it in your hands."
            duration=forever

                [filter]
                    id=OrcLeader
                [/filter]

                [effect]
                    apply_to=new_ability
                    [abilities]
                        [dummy]
                            id=Vessel
                            name=_"vicious vessel"
                            description=_"This unit carries The Vicious Vessel."
                        [/dummy]
                    [/abilities]
                [/effect]
                [effect]
                    apply_to=overlay
                    add=misc/vussel-overlay.png
                [/effect]
        [/object]
    [/event]

    [event]
    name=start 

        [message]
            speaker=Naga1 
            message=_ "Look, outsiders at the Phantom Outpost!"
        [/message]
        
        [scroll_to_unit]
            id=OrcLeader
        [/scroll_to_unit]

        {DELAY 300}

        [message]
            speaker=DarkLeader
            message=_ "Gyrza Dead-Eye! I am Herald Arzoteq, sent to you to deliver the will of Uria. Hear and obey: The Vicious Vessel you received from the Goddess has corrupted and severed your connection to Her. It has led you down the wrong path. Give the Vessel to me! I will fix it and return to you, if, of course, you are still a worthy bearer."
        [/message]

        [message]
            speaker=OrcLeader
            message=_ "Nonsense, Uria spoke to me in a dream, She told me to seize the river and exterminate the infidels, there was no talk of the Vessel!"
        [/message]

        [message]
            speaker=DarkLeader
            message=_ "It could not be the Goddess, for the magic of the Vessel drowns out Her voice. Therefore I was sent to you to be Her mouth."
        [/message]

        [message]
            speaker=OrcLeader
            message=_ "Are you using the name of Uria to deceive me and take the Vessel for yourself? Maybe you are one of the infidels She spoke of? Then I will kill you!"
        [/message]

        [message]
            speaker=DarkLeader
            message=_ "Come to your senses and do the will of the Goddess, or you'll be begging for death."
        [/message]

        [message]
            speaker=OrcLeader
            message=_ "Ha-ha, you decrepit deceiver, what will you do to the mighty orcs?"
        [/message]

        [message]
            sound=dwarf-laugh.wav
            speaker=DarkLeader
            message=_ "Now you'll find out!"
        [/message]

        {REPLACE_SCENARIO_MUSIC the_deep_path.ogg}
        {APPEND_MUSIC battle.ogg}
        {APPEND_MUSIC knolls.ogg}

        [animate_unit]
            flag=recruiting 
            [filter]
                id=DarkLeader 
            [/filter]
            [facing]
                x,y=6,6
            [/facing]
        [/animate_unit]

        {FLASH_RED ()}

        [terrain]
            x=38
            y=13
            radius=2
            terrain=Urb 
        [/terrain]

        {REDRAW ()}

        [animate_unit]
            flag=recruiting 
            [filter]
                id=DarkLeader 
            [/filter]
            [facing]
                x,y=6,6
            [/facing]
        [/animate_unit]

        {FLASH_RED ()}

        [terrain]
            x=38
            y=13
            radius=1
            terrain=Cud
        [/terrain]

        [terrain]
            x=38
            y=13
            terrain=Kud
        [/terrain]

        [store_locations]
            terrain=Cud
            variable=dark_castle
        [/store_locations]

        [foreach]
            array=dark_castle
            index_var=i
            [do]
                [item]
                    x=$this_item.x
                    y=$this_item.y
                    halo=halo/undead/idle-flash-[1~19].png:100
                [/item]   
            [/do]
        [/foreach]

        {CLEAR_VARIABLE dark_castle}

        {REDRAW ()}

        [animate_unit]
            flag=recruiting 
            [filter]
                id=DarkLeader 
            [/filter]
            [facing]
                x,y=6,6
            [/facing]
        [/animate_unit]

        [sound]
            name={SOUND_LIST:ZOMBIE_HIT}
        [/sound]

        {GENERIC_UNIT 3 "Mudavenger" 37 13 (animate=yes)} 

        [animate_unit]
            flag=recruiting 
            [filter]
                id=DarkLeader 
            [/filter]
            [facing]
                x,y=6,6
            [/facing]
        [/animate_unit]

        [sound]
            name={SOUND_LIST:ZOMBIE_HIT}
        [/sound]

        {GENERIC_UNIT 3 "Mudavenger" 38 14 (animate=yes)}

        [message]
            speaker=DarkLeader
            message=_ "I will reshape you into new, better servants of Uria!"
        [/message]

        [message]
            speaker=OrcLeader
            message=_ "The river will wait, warriors. First of all, capture the deceiver, I want to personally break all his bones!"
        [/message]

        [message]
            speaker=Naga2
            message=_ "The orc chieftain and the wizard are going to fight each other, we must defeat both of them to keep the river safe. That won't be easy."
        [/message]

        [message]
            speaker=Naga1
            message=_ "Yes, these outsiders are dangerous, but their feud gives us an advantage. Gather our ranks, strike at the right moment, and push them back!"
        [/message]

        [objectives]
            side=1,2
            [objective]
                [show_if]
                    [have_unit]
                        id=OrcLeader 
                    [/have_unit]
                [/show_if]
                description= _ "Defeat Gyrza the Dead Eye"
                condition=win
            [/objective]
            [objective]
                [show_if]
                    [have_unit]
                        id=DarkLeader
                    [/have_unit]
                [/show_if]
                description= _ "Defeat Arzoteq the Flesh Weaver"
                condition=win
            [/objective]
            [objective]
                [show_if]
                    [have_unit]
                        type=Dark Sphere
                    [/have_unit]
                [/show_if]
                caption=_ "Bonus Objective"
                description= _ "Destroy dark sphere to remove the darkness area, or destroy all spheres to deal a great damage to Arzoteq"
                condition=win
            [/objective]
            [objective]
                [show_if]
                    [variable]
                        name=orcish_ult
                        equals=yes
                    [/variable]
                [/show_if]
                caption=_ "Bonus Objective"
                description= _ "Capture the banner for make orcs fighting each other"
                condition=win
            [/objective]
            {DEATH_OF_LEADERS}
            {TURNS_RUN_OUT}
            [gold_carryover]
                carryover_percentage=40
            [/gold_carryover]
        [/objectives]
    [/event]

    [event]
    name=attack end
    first_time_only=yes 

        [filter]
            side=1,2
        [/filter]

        [filter_second]
            side=3
        [/filter_second]

        [message]
            scroll=no
            speaker=DarkLeader
            message=_ "More biological material? I wonder... If I sew their tails onto orc bodies, would I make good water servants?"
        [/message]
    [/event]

    [event]
    name=attack end
    first_time_only=yes 

        [filter]
            side=1,2
        [/filter]

        [filter_second]
            side=4
        [/filter_second]

        [message]
            scroll=no
            speaker=OrcLeader
            message=_ "Water worms getting in my fight? All right, then I will kill all the infidels at once!"
        [/message]
    [/event]

    #Outpost events

    [event]
    name=new turn 
    first_time_only=no 

        [filter_condition]
            [have_location]
                time_of_day_id=dusk1,dusk2
            [/have_location]
        [/filter_condition]

        [scroll_to]
            x,y=22,15
        [/scroll_to]

        {FLASH_BLUE (
        [sound]
            name=wail-long.wav
        [/sound])}

        {TERR_MASK_IN_EVENT "{~add-ons/Lair_of_Thugs/maps/Phantom_Outpost_Mask.mask}" 18 12}
        {DELAY 300}
    [/event]

    [event]
    name=new turn 
    first_time_only=no 

        [filter_condition]
            [have_location]
                time_of_day_id=dawn1,dawn2
            [/have_location]
        [/filter_condition]

        [scroll_to]
            x,y=22,15
        [/scroll_to]

        {FLASH_BLUE (
        [sound]
            name=wail-long.wav
        [/sound])}

        {TERR_MASK_IN_EVENT "{~add-ons/Lair_of_Thugs/maps/No_Phantom_Outpost_Mask.mask}" 18 12}
        {DELAY 300}
    [/event]

    #define PHANTOM_OUTPOST_CAPTURE X Y
    [event]
    name=capture 
    first_time_only=yes 

        [filter]
            [and]
                side=1 
                [or]
                    side=2
                [/or]
            [/and]
            [filter_location]
                x,y={X},{Y}
            [/filter_location]
        [/filter]

        [message]
            image=wesnoth-icon.png
            speaker=narrator
            message=_ "Inside the phantom outpost sat ghosts in the robes of a long-dead civilization. They acted as if they were alive, and all of them spoke of a Wesnoth whose golden age was about to come."
        [/message]

        [store_unit]
            [filter]
                find_in=unit 
            [/filter]
            variable=reader
        [/store_unit]

        {VARIABLE_OP reader.experience add 16}

        [floating_text]
            x,y={X},{Y}
            text="<span color='#800080'>" + _ "+16 exp" + "</span>"
        [/floating_text]

        [unstore_unit]
            variable=reader
        [/unstore_unit]
    [/event]   
    #enddef

    {PHANTOM_OUTPOST_CAPTURE 21 15}
    {PHANTOM_OUTPOST_CAPTURE 23 15}

    #defensive behavior for ai

    [event]
    name=side 3 turn 
    id=dark_caution
    first_time_only=no 

        [if]
            [have_unit]
                side=1,2
                count=3-100 
                [not]
                    level=0 
                [/not]
                [filter_location]
                    x,y,radius=38,13,7
                [/filter_location]
            [/have_unit]
        [then]
            {MODIFY_SIDE_AI (3) (grouping=defensive)}
            {ADD_LEADER_GOAL 3 dark_def 38 13 no 1}

            {MODIFY_AI_ADD_GOAL 3 (
            [goal]
                id=dark_defending
                name=protect_unit
                [criteria]
                    id=DarkLeader
                [/criteria]
                value=100
            [/goal]
            )}
        [/then]
        [else]
            {MODIFY_SIDE_AI (3) (grouping=no)}

            [modify_ai]
                side=3
                action=delete
                path=aspect[leader_goal].facet[dark_def]
            [/modify_ai]

            [modify_ai]
                side=3
                action=delete
                path=goal[dark_defending]
            [/modify_ai]
        [/else]
        [/if]
    [/event]

    [event]
    name=side 4 turn 
    first_time_only=no 

        [if]
            [have_unit]
                side=1,2
                count=3-100
                [not]
                    level=0 
                [/not]
                [filter_location]
                    x,y,radius=7,13,7
                [/filter_location]
            [/have_unit]
        [then]

            {MODIFY_SIDE_AI (4) (grouping=defensive)}
            {ADD_LEADER_GOAL 4 orc_def 7 13 no 1}

            {MODIFY_AI_ADD_GOAL 4 (
            [goal]
                id=orc_defending
                name=protect_unit
                [criteria]
                    id=OrcLeader
                [/criteria]
                value=100
            [/goal]
            )}
        [/then]

        [else]

            [modify_ai]
                side=4
                action=delete
                path=aspect[leader_goal].facet[orc_def]
            [/modify_ai]

            {MODIFY_SIDE_AI (4) (grouping=no)}

            [modify_ai]
                side=4
                action=delete
                path=goal[orc_defending]
            [/modify_ai]
        [/else]
        [/if]
    [/event]

    #Ивенты смерти 
    #Орк умирает. 1. Его убили наги. 2. Его убил колдун. Он последний?
    #Колдун умирает. 1. Его убили наги. 2. Его убил орк. Он последний? Он забрал сосуд?

    [event]
    name=last breath 

        [filter]
            id=OrcLeader 
        [/filter] 

        [remove_object]
            id=Vussel_Orc
        [/remove_object]

        [message]
            speaker=unit 
            message=_ "The worthless Vessel has done nothing to help me, where is its great power? Uria has deceived me!"
        [/message]
    [/event]

    #dark ult

    #define SPHERE_EVENT NUMBER X Y
            [event]
            name=sphere_grown_event{NUMBER}
            id=sphere_grown_event{NUMBER}
            first_time_only=no

                [if]
                    [have_unit]
                        id=sphere{NUMBER}
                    [/have_unit]
                [then]
                    [time_area]
                        id=dark_zone{NUMBER}
                        x,y,radius={X},{Y},$radius
                        [time]
                            blue=-115
                            description=_"Darkness"
                            green=-115
                            id="darkness"
                            image=""
                            lawful_bonus=-50
                            name=_"Darkness"
                            red=-115
                        [/time]
                    [/time_area]
                    [redraw][/redraw] 
                [/then]
                [/if]
            [/event]

            [event]
            name=side 3 turn 
            first_time_only=no 

                [if]
                    [have_unit]
                        side=1
                        x,y,radius={X},{Y},1
                    [/have_unit]
                [then]

                    {MODIFY_AI_ADD_GOAL 3 (
                    [goal]
                        id=protect_sphere
                        name=protect_unit
                        [criteria]
                            id=sphere{NUMBER}
                        [/criteria]
                        value=100
                    [/goal]
                    )}
                [/then]
                [else]
                    [modify_ai]
                        side=3
                        action=delete
                        path=goal[protect_sphere]
                    [/modify_ai]
                [/else]
                [/if]
            [/event]
            
            [event]
            name=die 

                [filter]
                    id=sphere{NUMBER}
                [/filter]

                [filter_second]
                    [not]
                        type_adv_tree="Vampire Bat"
                    [/not]
                [/filter_second]

                [remove_time_area]
                    id=dark_zone{NUMBER}
                [/remove_time_area]

                [remove_event]
                    id=sphere_grown_event{NUMBER}
                [/remove_event]

                [object]
                    silent=no 
                    id=chaotic{NUMBER}
                    duration=forever 
                    image="halo/undead/dark-magic-1.png"
                    description=_ "The energy of the sphere penetrated the essence of the unit who destroyed it, and made him <i>chaotic</i> and <i>fearless</i>."

                    [filter]
                        find_in=second_unit 
                    [/filter]

                    [effect]
                        apply_to=alignment
                        set=chaotic 
                    [/effect]

                    [effect]
                        apply_to="fearless"
                    [/effect]

                    [effect]
                        apply_to=new_ability 

                        [abilities]
                            [dummy]
                                id=fearless_ui 
                                name=_ "fearless"
                                female_name=_ "female^fearless"
                                description= _ "Fights normally during unfavorable times of day/night"
                                 help_text= _ "Aversion to light and dark holds no sway over these brave individuals."
                            [/dummy]
                        [/abilities]
                    [/effect]

                    [effect]
                        apply_to=overlay
                        add="misc/chaotic.png"
                    [/effect]
                [/object]
            [/event]

            [event]
            name=die 

                [filter]
                    id=sphere{NUMBER}
                [/filter]

                [filter_second]
                    type_adv_tree="Vampire Bat"
                [/filter_second]

                [remove_time_area]
                    id=dark_zone{NUMBER}
                [/remove_time_area]

                [remove_event]
                    id=sphere_grown_event{NUMBER}
                [/remove_event]

                [object]
                    silent=no 
                    id=chaotic{NUMBER}
                    duration=forever 
                    image="halo/undead/dark-magic-1.png"
                    description=_ "The energy of the sphere penetrated the essence of the bat who destroyed it, and made it <i>fearless</i> and dealing 25% more damage."

                    [filter]
                        find_in=second_unit 
                    [/filter]

                    [effect]
                        apply_to=attack
                        increase_damage=25%
                    [/effect]

                    [effect]
                        apply_to="fearless"
                    [/effect]

                    [effect]
                        apply_to=new_ability 

                        [abilities]
                            [dummy]
                                id=fearless_ui 
                                name=_ "fearless"
                                female_name=_ "female^fearless"
                                description= _ "Fights normally during unfavorable times of day/night"
                                 help_text= _ "Aversion to light and dark holds no sway over these brave individuals."
                            [/dummy]
                        [/abilities]
                    [/effect]

                    [effect]
                        apply_to=overlay
                        add="misc/chaotic.png"
                    [/effect]
                [/object]
            [/event]
    #enddef

    {SPHERE_EVENT 1 33 11}
    {SPHERE_EVENT 2 38 18}
    {SPHERE_EVENT 3 33 16}

    [event]
    name=die 

        [filter]
            id=OrcLeader
        [/filter]

        [filter_second]
            side=1,2
        [/filter_second]

        [message]
            speaker=second_unit
            message=_ "The stinking orc chieftain has been defeated! He was carrying some kind of precious Vessel behind his back. It's so graceful, so smooth, I can see my own reflection in it!"
        [/message]

        [message]
            side=$second_unit.side
            canrecruit=yes
            message=_ "By law, all jewels belong to the leader, give the Vessel to me! And demolish the orc camp, lest it be used by other invaders."
        [/message] 

        [object]
            silent=no
            id=vicious_vessel
            name=_"The Vicious Vessel"
            image=items/ornate2.png
            description= _ "The mysterious vessel that Uria's cultists need so badly. It evokes an ominous energy, but at the same time, it beckons you to hold it in your hands."
            duration=forever

                [filter]
                    side=$second_unit.side
                    canrecruit=yes
                [/filter]

                [effect]
                    apply_to=new_ability
                    [abilities]
                        [dummy]
                            id=vicious_vessel
                            name=_"vicious vessel"
                            description=_"This unit carries The Vicious Vessel."
                        [/dummy]
                    [/abilities]
                [/effect]

                [effect]
                    apply_to=overlay
                    add=misc/vussel-overlay.png
                [/effect]
        [/object]

        [fire_event]
            name=Arzuteq_ult 
        [/fire_event]
    [/event]

    [event]
    name=die 

        [filter]
            id=OrcLeader
        [/filter]

        [filter_second]
            [not]
                side=1,2
            [/not]
        [/filter_second]

        [message]
            side=1 
            race=naga 
            canrecruit=no
            message=_ "The stinking orc chieftain has been defeated! He was carrying some kind of precious Vessel behind his back. It's so graceful, so smooth, I can see my own reflection in it!"
        [/message]

        [message]
            speaker=Naga1
            message=_ "By law, all jewels belong to the leader, give the Vessel to me! And demolish the orc camp, lest it be used by other invaders."
        [/message] 

        [object]
            silent=no
            id=vicious_vessel
            name=_"The Vicious Vessel"
            image=items/ornate2.png
            description= _ "The mysterious vessel that Uria's cultists need so badly. It evokes an ominous energy, but at the same time, it beckons you to hold it in your hands."
            duration=forever

                [filter]
                    id=Naga1
                [/filter]

                [effect]
                    apply_to=new_ability
                    [abilities]
                        [dummy]
                            id=vicious_vessel
                            name=_"vicious vessel"
                            description=_"This unit carries The Vicious Vessel."
                        [/dummy]
                    [/abilities]
                [/effect]

                [effect]
                    apply_to=overlay
                    add=misc/vussel-overlay.png
                [/effect]
        [/object]

        [fire_event]
            name=Arzuteq_ult 
        [/fire_event]
    [/event]

    [event]
    name=Arzuteq_ult 
    first_time_only=yes

        [store_unit]
            [filter]
                ability=vicious_vessel
            [/filter]
            kill=no 
            variable=naga_vessel
        [/store_unit]

        [store_unit]
            [filter]
                race=naga 
                canrecruit=yes 
                [not]
                    ability=vicious_vessel
                [/not]
            [/filter]
            kill=no 
            variable=naga_no_vessel
        [/store_unit]

        [scroll_to]
            x,y=7,13 
        [/scroll_to]

        {DELAY 300}

        [sound]
            name=cave-in.ogg 
        [/sound]

        [terrain]
            [and]
                terrain=Cer
            [/and]
            terrain=Re^Edt
        [/terrain]

        [terrain]
            [and]
                terrain=Ke
            [/and]
            terrain=Re^Edt
        [/terrain]

        [terrain]
            [and]
                terrain=Re^Efc
            [/and]
            terrain=Re^Edt
        [/terrain]

        [store_locations]
            terrain=*^Ecf,*^Ebn
            variable=campfires
        [/store_locations]

        [foreach]
            array=campfires
            index_var=i
            [do] 
                [terrain]
                    x,y=$this_item.x,$this_item.y
                    terrain=Re^Edt
                [/terrain]
                [remove_time_area]
                    id=campfire_|$this_item.x|_|$this_item.y|
                [/remove_time_area]     
                [remove_sound_source]
                    id=campfire_|$this_item.x|_|$this_item.y|
                [/remove_sound_source]        
            [/do]
        [/foreach]

        {CLEAR_VARIABLE campfires}

        {REDRAW ()}

        {REMOVE_IMAGE 10 8}

        [if]
            [have_unit]
                id=DarkLeader
            [/have_unit]
        [then]

            {INCIDENTAL_MUSIC revelation.ogg}

            [message]
                speaker=DarkLeader
                message=_ "You vile snakes, give the vessel back to me, and maybe I'll leave some of you in pristine condition."
            [/message]

            [message]
                find_in=naga_no_vessel
                message=_ "Should we return the Vessel, see if the wizard will indeed calm down?"
            [/message]

            [message]
                find_in=naga_vessel
                message=_ "He wanted to do terrible things to us, he won't calm down! And the Vessel is my trophy, I won't give it to anyone!"
            [/message]

            [message]
                speaker=DarkLeader
                message=_ "Enough of testing my patience. Now you will know how terrible I am in my anger. Impenetrable darkness will be the last thing you see before you are reborn as my servants!"
            [/message]

            [scroll_to]
                id=DarkLeader
            [/scroll_to]

            [animate_unit]
                flag=recruiting 
                [filter]
                    id=DarkLeader 
                [/filter]
                [facing]
                    x,y=6,6
                [/facing]
            [/animate_unit]

            {UNIT 3 "Dark Sphere" 33 11 (
            id=sphere1
            animate=yes
            )}

            [time_area]
                id=dark_zone1
                [time]
                    blue=-115
                    description=_"Darkness"
                    green=-115
                    id="darkness"
                    image=""
                    lawful_bonus=-50
                    name=_"Darkness"
                    red=-115
                [/time]
                x,y,radius=33,11,1
            [/time_area]

            {REDRAW ()}

            [animate_unit]
                flag=recruiting 
                [filter]
                    id=DarkLeader 
                [/filter]
                [facing]
                    x,y=6,6
                [/facing]
            [/animate_unit]

            {UNIT 3 "Dark Sphere" 38 18 (
            id=sphere2
            animate=yes
            )}

            [time_area]
                id=dark_zone2
                [time]
                    blue=-115
                    description=_"Darkness"
                    green=-115
                    id="darkness"
                    image=""
                    lawful_bonus=-50
                    name=_"Darkness"
                    red=-115
                [/time]
                x,y,radius=38,18,1
            [/time_area]

            {REDRAW ()}

            [animate_unit]
                flag=recruiting 
                [filter]
                    id=DarkLeader 
                [/filter]
                [facing]
                    x,y=6,6
                [/facing]
            [/animate_unit]

            {UNIT 3 "Dark Sphere" 33 16 (
            id=sphere3
            animate=yes
            )}

            [time_area]
                id=dark_zone3
                [time]
                    blue=-115
                    description=_"Darkness"
                    green=-115
                    id="darkness"
                    image=""
                    lawful_bonus=-50
                    name=_"Darkness"
                    red=-115
                [/time]
                x,y,radius=33,16,1
            [/time_area]

            {REDRAW ()}

            {VARIABLE radius 1}

            {MODIFY_AI_ADD_GOAL 3 (
            [goal]
                id=defend_spheres
                name=protect_unit
                [criteria]
                    type=Dark Sphere
                [/criteria]
                value=2
            [/goal]
            )}

            [message]
                find_in=naga_no_vessel
                message=_ "We can't fight the wizards's monsters in the eternal night, at first we must destroy the spheres and stop the darkness!"
            [/message]

            [event]
            name=side 3 turn
            first_time_only=no 

                {VARIABLE_OP radius add 1}

                [scroll_to]
                    x,y=39,13
                [/scroll_to]

                {DELAY 100}

                [sound]
                    name=magic-dark-big-miss.ogg 
                [/sound]

                [fire_event]
                    id=sphere_grown_event1
                [/fire_event]

                [fire_event]
                    id=sphere_grown_event2
                [/fire_event]

                [fire_event]
                    id=sphere_grown_event3
                [/fire_event]
            [/event]

            [gold]
                side=3
                amount={ON_DIFFICULTY 100 130 155}
            [/gold]

            [remove_event]
                id=dark_caution
            [/remove_event]

            [modify_side]
                side=3

                {AI_IN_TIME {TWO_SUNS_CHAOTIC_TIME} (
        
                    grouping=no
                    aggression=1
                    caution=0)}

                {AI_IN_TIME {TWO_SUNS_NEUTRAL_TIME} (
                
                    grouping=no
                    aggression=1
                    caution=0
                    )}

                {AI_IN_TIME {TWO_SUNS_LAWFUL_TIME} (
                
                    grouping=no
                    aggression=1
                    caution=0)}
            [/modify_side]

            [event]
            name=die 
            first_time_only=no 

                [filter]
                    type=Dark Sphere 
                [/filter]

                {REDRAW ()}

                [if]
                    [have_unit]
                        type=Dark Sphere 
                    [/have_unit]
                [then]
                [/then]

                [else]
                    [scroll_to_unit]
                        id=DarkLeader 
                    [/scroll_to_unit]

                    [message]
                        speaker=DarkLeader
                        message=_ "Ar, maintaining the spell cost me a lot of effort, and they broke it nonetheless!"
                    [/message]

                    {DELAY 300}

                    {FLASH_RED ()}
                    [harm_unit]
                        [filter]
                            id=DarkLeader
                        [/filter]
                        amount=55
                        fire_event=yes
                        animate=yes
                        kill=no
                    [/harm_unit]

                    [message]
                        speaker=Naga1
                        message=_ "The wizard is weakened, let's strike a decisive strike!"
                    [/message]
                [/else]
                [/if]
            [/event]
        [/then]   
        [/if]
    [/event]

    #orcish_ult 

    #define ORCISH_BANNER

    [event]
        name=moveto 
        first_time_only=yes 

            [filter]
                side=1,2
                [filter_location]
                    x,y=10,8
                [/filter_location]
            [/filter]

            [message]
                speaker=unit
                message=_ "The orcish banner is awe-inspiring. I think it would make a great trophy! (get the leadership-like ability)."
            [/message]

            [message]
                speaker=unit
                message= _ "Should I capture it?"

                    [option]
                        label= _ "Yes, I’ll take it."
                        [command]
                            [object]
                                name=_"Orcish Banner"
                                image=items/orcish-flag3.png
                                description= _ "The tattered banner to commemorate the victory over the Dead Eye and inspire the allies."
                                duration=forever
                                [filter]
                                    x,y=10,8
                                [/filter]
                                [effect]
                                    apply_to=new_ability
                                    [abilities]
                                        [leadership]
                                            id=banner
                                            add=25
                                            cumulative=yes
                                            name=_ "Dead Eye banner"
                                            female_name=_ "Dead Eye banner"
                                            description=_ "This unit can lead ~allied~ units that are next to it, making them fight better. Adjacent allied units will do 25% more damage. This is cumulative with leadership."
                                            affect_self=no
                                            affect_allies=yes
                                            [affect_adjacent]
                                            adjacent=n,ne,se,s,sw,nw
                                            [/affect_adjacent]
                                        [/leadership]
                                    [/abilities]
                                [/effect]
                                [effect]
                                    apply_to=overlay
                                    add="misc/banner.png"
                                [/effect]
                            [/object]

                            [modify_unit]
                                [filter]
                                    find_in=unit 
                                [/filter]
                                role=naga_banner 
                            [/modify_unit]

                            {REMOVE_IMAGE 10 8}

                            [remove_sound_source]
                                id=orcish_ult
                            [/remove_sound_source]

                            [modify_ai]
                                side=4
                                action=delete
                                path=goal[orc_defends_banner]
                            [/modify_ai]
                            
                            [fire_event]
                                name=orcs_lost_banner 
                            [/fire_event]
                            
                        [/command]
                    [/option]

                    [option]
                        label= _ "No, I think someone else should capture it."

                        [command]

                            [event]
                            name=moveto
                            id=take_banner
                            first_time_only=no

                                [filter]
                                    side=1,2
                                    [filter_location]
                                        x,y=10,8
                                    [/filter_location]
                                [/filter]

                                [message]
                                    speaker=unit
                                    message= _ "Should I capture this banner?"

                                        [option]
                                            label= _ "Yes, I’ll capture it."
                                            [command]
                                                [object]
                                                    name=_"Orcish Banner"
                                                    image=items/orcish-flag3.png
                                                    description= _ "The tattered banner to commemorate the victory over Dead Eye and inspire the allies."
                                                    duration=forever

                                                    [filter]
                                                        x,y=10,8
                                                    [/filter]

                                                        [effect]
                                                            apply_to=new_ability
                                                            [abilities]
                                                                [leadership]
                                                                    id=banner
                                                                    add=25
                                                                    cumulative=yes
                                                                    name=_ "Dead Eye banner"
                                                                    female_name=_ "Dead Eye banner"
                                                                    description=_ "This unit can lead ~allied~ units that are next to it, making them fight better. Adjacent allied units will do 25% more damage. This is cumulative with leadership."
                                                                    affect_self=no
                                                                    affect_allies=yes
                                                                    [affect_adjacent]
                                                                    adjacent=n,ne,se,s,sw,nw
                                                                    [/affect_adjacent]
                                                                [/leadership]
                                                            [/abilities]
                                                        [/effect]
                                                        [effect]
                                                            apply_to=overlay
                                                            add="misc/banner.png"
                                                        [/effect]
                                                [/object]

                                                [modify_unit]
                                                    [filter]
                                                        find_in=unit 
                                                    [/filter]
                                                    role=naga_banner 
                                                [/modify_unit]

                                                {REMOVE_IMAGE 10 8}

                                                [remove_sound_source]
                                                    id=orcish_ult
                                                [/remove_sound_source]

                                                [remove_event]
                                                    id=take_banner
                                                [/remove_event]

                                                [modify_ai]
                                                    side=4
                                                    action=delete
                                                    path=goal[orc_defends_banner]
                                                [/modify_ai]

                                                [fire_event]
                                                    name=orcs_lost_banner 
                                                [/fire_event]
                                            [/command]
                                        [/option]

                                        [option]
                                            label= _ "No, I think someone else should capture it."
                                        [command]
                                        [allow_undo][/allow_undo]
                                        [/command]
                                    [/option]
                                [/message]
                            [/event]
                    [/command]
                [/option]
            [/message]   
    [/event]
    #enddef

    [event]
    name=recruit 
    id=recruit_rebels_event
    first_time_only=no 

        [filter]
            side=4
        [/filter]

        {VARIABLE_OP recruit_side rand 4,5}

        {IF_VAR recruit_side equals 5 (
        [then]
            [modify_unit]
                [filter]
                    find_in=unit 
                [/filter]
                role=rebel 
            [/modify_unit]
        [/then]
        )}

        {IF_VAR rebellion equals yes (
        [then]
            [modify_unit]
                [filter]
                    role=rebel
                [/filter]
                side=5
            [/modify_unit]
        [/then]
        )}
    [/event]

    [event]
    name=last breath 

        [filter]
            id=DarkLeader
        [/filter] 

        [message]
            speaker=unit 
            message=_ "Uria, how?"
        [/message]
    [/event]

    [event]
    name=die 

        [filter]
            id=DarkLeader
        [/filter]

        {FLASH_RED (
        [sound]
            name=magic-dark-big-miss.ogg
        [/sound]
        )}

        [remove_time_area]
            id=dark_castle
        [/remove_time_area]

        [store_locations]
            terrain=Cud
            variable=dark_castle
        [/store_locations]

        [foreach]
            array=dark_castle
            index_var=i
            [do]
                [remove_item]
                    x=$this_item.x
                    y=$this_item.y
                [/remove_item]   
            [/do]
        [/foreach]

        {CLEAR_VARIABLE dark_castle}

        {TERR_MASK_IN_EVENT "{~add-ons/Lair_of_Thugs/maps/Defeated_Wizard.mask}" 34 11}

        [message]
            speaker=second_unit 
            message=_ "The hideous wizard is defeated!"
        [/message]

        [if]
            [have_unit]
                id=OrcLeader
            [/have_unit]
        [then]

            {VARIABLE orcish_ult yes}

            {INCIDENTAL_MUSIC northerners.ogg} 

            [message]
                speaker=OrcLeader 
                message=_ "Bah, I wanted to kill Arzoteq myself. But nothing will stop me from fulfilling my main goal, which is to crusade for the glory of Uria against the wretched inhabitants of this river!"
            [/message]

            [if]
                [have_unit]
                    x,y=10,8
                [/have_unit]
            [then]
                {MOVE_UNIT id=OrcLeader 9 9}
                [harm_unit]
                    [filter]
                        x,y=10,8
                    [/filter]
                    [filter_second]
                        id=OrcLeader 
                    [/filter_second]
                    [primary_attack]
                        range=melee 
                    [/primary_attack]
                    type=blade 
                    amount=100
                    fire_event=yes 
                    animate=yes
                    kill=yes 
                [/harm_unit]

                {MOVE_UNIT id=OrcLeader 10 8}
            [/then]
            [else]
                {MOVE_UNIT id=OrcLeader 10 8}
            [/else]
            [/if]

            [message]
                speaker=OrcLeader 
                message=_ "From this mountain, my banner will be visible from anywhere on the battlefield. Let it strike terror into the hearts of my enemies and inspire my warrior!"
            [/message]

            {PLACE_IMAGE items/orcish-flag3.png 10 8}

            [item]
                x,y=10,8 
                halo=halo/lighthouse-aura.png~BLEND(255,0,0,1)
            [/item]

            [sound_source]
                id=orcish_ult
                loop=-1
                x,y=10,8
                sounds=ambient/wardrums.ogg
                full_range=15
                fade_range=15
            [/sound_source] 

            {ORCISH_BANNER}
            
            [if]
                [have_unit]
                    x,y=7,13
                [/have_unit]
            [then]
                {MOVE_UNIT id=OrcLeader 7 12} 
                [harm_unit]
                    [filter]
                        x,y=7,13
                    [/filter]
                    [filter_second]
                        id=OrcLeader 
                    [/filter_second]
                    [primary_attack]
                        range=melee 
                    [/primary_attack]
                    type=blade 
                    amount=100
                    animate=yes
                    fire_event=yes 
                    kill=yes 
                [/harm_unit]

                {MOVE_UNIT id=OrcLeader 7 13}
            [/then]
            [else]
                {MOVE_UNIT id=OrcLeader 7 13} 
            [/else]
            [/if]

            [gold]
                side=4
                amount={ON_DIFFICULTY 80 120 170}
            [/gold]

            [message]
                speaker=Naga1 
                message=_ "That banner does make me nervous. We must capture it, or the fight will never be won!"
            [/message]

            [event]
            name=recruit
            id=banner_guard
            first_time_only=no

                [filter]
                    side=4
                [/filter]

                [modify_unit]
                    [filter]
                        find_in=unit 
                    [/filter]
                    role=defender_of_banner
                    name=_ "Orc Guard"
                    [ai]
                        [micro_ai]
                            ai_type=zone_guardian
                            action=add

                            [filter]
                                role=defender_of_banner
                            [/filter]
                            [filter_location]
                                x,y=10,8
                                radius=2
                            [/filter_location]
                            station_x,station_y=10,8
                        [/micro_ai]
                    [/ai]
                [/modify_unit]

                {VARIABLE_OP guards_count add 1}
                {IF_VAR guards_count numerical_equals {ON_DIFFICULTY 1 2 2} (
                [then]
                    [remove_event]
                        id=banner_guard
                    [/remove_event]
                [/then])}
            [/event]

            [event]
                name=orcs_lost_banner 
                first_time_only=yes 

                {VARIABLE rebellion yes}

                [modify_unit]
                    [filter]
                        role=rebel
                    [/filter]
                    side=5
                [/modify_unit]

                [remove_event]
                    id=orcish_banner_ai 
                [/remove_event]

                [micro_ai]
                    side=5
                    ai_type=simple_attack
                    action=add

                    ca_score=110000
                    [filter]
                        side=5
                    [/filter]
                    [filter_second]
                        side=4
                    [/filter_second]
                [/micro_ai]

                [message]
                    side=5
                    message=_ "You've lost the banner, Gyrza! You're a worthless leader, we'll choose a new one!"
                [/message]

                [message]
                    speaker=OrcLeader
                    message=_ "Traitors, I will slaughter you as a sacrifice to Uria when the battle is over!"
                [/message]

                [message]
                    speaker=Naga2
                    message=_ "Our plan worked, without the banner the orcs fought each other. Now we can get to their chieftain."
                [/message]
            [/event]

            [event]
            name=side 4 turn 
            id=orcish_banner_ai
            first_time_only=no 

                [if]
                    [have_unit]
                        side=1,2
                        count=2-100
                        [not]
                            level=0 
                        [/not]
                        [filter_location]
                            x,y,radius=10,8,3
                        [/filter_location]
                    [/have_unit]
                [then]
                    {MODIFY_AI_ADD_GOAL 4 (
                    [goal]
                        id=orc_defends_banner
                        name=target_location
                        [criteria]
                            x,y=10,8
                        [/criteria]
                        value=100
                    [/goal]
                )}
                [/then]

                [else]
                    [modify_ai]
                        side=4
                        action=delete
                        path=goal[orc_defends_banner]
                    [/modify_ai]
                [/else]
                [/if]
            [/event]

            [event]
            name=die 

                [filter]  
                    role=naga_banner 
                [/filter]  

                [switch]
                variable=second_unit.side 
                    [case]
                        value=4

                        [message]
                            speaker=OrcLeader 
                            message=_ "The banner is back in my hands, and the traitors are back in the ranks."
                        [/message]

                        [modify_unit]
                            [filter]
                                side=5
                            [/filter]
                            side=4
                        [/modify_unit]

                        [remove_event]
                            id=recruit_rebels_event
                        [/remove_event]
                    [/case]
                    [case]
                        value=5
                    [/case]
                [/switch]
            [/event]
        [/then]
        [else]
        [/else]
        [/if]
    [/event]

    [event]
    name=victory 

        {REPLACE_SCENARIO_MUSIC wanderer.ogg}

        [message]
            speaker=narrator 
            image=wesnoth-icon.png
            message=_ "With the death of their leaders, the invaders ran away from the brave nagas maintaining their lines and determination."
        [/message]

        [kill]
            side=3,4,5
            animate=no 
        [/kill]

        [message]
            find_in=naga_no_vessel
            message=_ "Another outsider invasion fought off, which means our river is safe. For a while. "
        [/message]

        [message]
            find_in=naga_vessel
            message=_ "I don't know if we could have won if the orcs and the wizard hadn't fought over the Vessel. I wonder what's so special about it?"
        [/message]

        [message]
            find_in=naga_no_vessel
            message=_ "Let's look into it later, now is no time to check out the trophies. We should collect the bodies of our fallen kin and return to the oasis."
        [/message]
    [/event]  
[/scenario]
